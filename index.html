<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <title>Grow A Plant!</title>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>ğŸŒ± Grow A Plant!</h1>
        </div>
        <div class="game-area">
            <div class="stats">
                <div class="stat">
                    <span class="stat-label">ğŸ’§ Water:</span>
                    <div class="stat-bar">
                        <div class="stat-fill water-fill" id="water-bar" style="width: 100%"></div>
                    </div>
                    <span id="water-percent">100%</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ğŸ˜Š Happy:</span>
                    <div class="stat-bar">
                        <div class="stat-fill happiness-fill" id="happiness-bar" style="width: 80%"></div>
                    </div>
                    <span id="happiness-percent">80%</span>
                </div>
                <div class="stat">
                    <span class="stat-label">ğŸŒ¿ Plant:</span>
                    <span id="plant-type">Sunflower</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Status:</span>
                    <span id="plant-status">Alive</span>
                </div>
            </div>
            <div class="plant-container">
                <div class="pot" id="pot">
                    <div class="plant" id="plant">ğŸŒ»</div>
                </div>
            </div>
            <div class="notifications" id="notifications"></div>
        </div>

        <div class="controls">
            <button class="control-btn water-btn" id="water-btn" onclick="waterPlant()">ğŸ’§ Water Plant</button>
            <button class="control-btn reset-btn" id="reset-btn" onclick="resetPlant()" style="display: none;">ğŸ”„ Reset Plant</button>
            <button class="control-btn decorate-btn" id="decorate-btn" onclick="decoratePot()">ğŸ¨ Decorate Pot</button>
            <button class="control-btn plant-select" onclick="showPlantMenu()">ğŸŒ± Change Plant</button>
        </div>

        <div class="plant-menu" id="plant-menu">
            <h3>Choose Your Plant:</h3>
            <div class="plant-options">
                <div class="plant-option" onclick="selectPlant('sunflower', 'ğŸŒ»')">ğŸŒ»</div>
                <div class="plant-option" onclick="selectPlant('rose', 'ğŸŒ¹')">ğŸŒ¹</div>
                <div class="plant-option" onclick="selectPlant('tulip', 'ğŸŒ·')">ğŸŒ·</div>
                <div class="plant-option" onclick="selectPlant('cactus', 'ğŸŒµ')">ğŸŒµ</div>
                <div class="plant-option" onclick="selectPlant('tree', 'ğŸŒ³')">ğŸŒ³</div>
            </div>
            <button class="close-btn" onclick="closePlantMenu()">Close</button>
        </div>
    </div>

    <div class="death-overlay" id="death-overlay">
        <div class="death-message">
            <h2>ğŸ’€ Your Plant Died!</h2>
            <p id="death-reason"></p>
            <p>Your plant couldn't survive without water for too long.</p>
            <button class="revive-btn" onclick="resetPlant()">ğŸŒ± Start Over</button>
        </div>
    </div>

    <script>
        // minutes it takes for plant to die at 0 water (doesn't die immediately at 0 water)
        const plantConfigs = {
            sunflower: { emoji: 'ğŸŒ»', waterLossRate: 2.0, deathTime: 5 }, 
            rose: { emoji: 'ğŸŒ¹', waterLossRate: 2.5, deathTime: 3 },
            tulip: { emoji: 'ğŸŒ·', waterLossRate: 1.8, deathTime: 4 },
            cactus: { emoji: 'ğŸŒµ', waterLossRate: 0.8, deathTime: 15 },
            tree: { emoji: 'ğŸŒ³', waterLossRate: 1.5, deathTime: 8 } 
        };

        let gameState = {
            currentPlant: 'sunflower',
            plants: {}
        };

        function initializePlants() {
            Object.keys(plantConfigs).forEach(plantType => {
                if (!gameState.plants[plantType]) {
                    gameState.plants[plantType] = {
                        ...plantConfigs[plantType],
                        waterLevel: 100,
                        happiness: 80,
                        colorIndex: 0,
                        lastWatered: Date.now(),
                        lastUpdate: Date.now(),
                        isDead: false,
                        timeAtZeroWater: 0 
                    };
                }
            });
        }

        const colors = ['', 'red', 'orange', 'yellow', 'green', 'blue', 'purple'];

        function getCurrentPlant() {
            return gameState.plants[gameState.currentPlant];
        }

        // Load game data on startup
        function loadGame() {
            try {
                const savedData = localStorage.getItem('plantCareGame');
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    
                    if (parsed.currentPlant) {
                        gameState.currentPlant = parsed.currentPlant;
                    }
                    if (parsed.plants) {
                        gameState.plants = parsed.plants;
                    }
                }
            } catch (error) {
                console.log('Could not load game data:', error);
            }
            
            initializePlants();
            
            // Apply decay to ALL plants based on time away
            const now = Date.now();
            let maxMinutesAway = 0;
            
            Object.keys(gameState.plants).forEach(plantType => {
                const plant = gameState.plants[plantType];
                const config = plantConfigs[plantType];
                const timeSinceLastUpdate = now - (plant.lastUpdate || now);
                const minutesAway = timeSinceLastUpdate / (1000 * 60);
                
                if (minutesAway > maxMinutesAway) {
                    maxMinutesAway = minutesAway;
                }
                
                if (minutesAway > 1 && !plant.isDead) {
                    const waterDecay = minutesAway * config.waterLossRate;
                    const oldWaterLevel = plant.waterLevel;
                    
                    plant.waterLevel = Math.max(0, plant.waterLevel - waterDecay);
                    
                    // Track time at zero water
                    if (plant.waterLevel === 0) {
                        if (oldWaterLevel > 0) {
                            plant.timeAtZeroWater = minutesAway - (oldWaterLevel / config.waterLossRate);
                        } else {
                            plant.timeAtZeroWater += minutesAway;
                        }
                        
                        if (plant.timeAtZeroWater >= config.deathTime) {
                            plant.isDead = true;
                            plant.happiness = 0;
                        }
                    } else {
                        plant.timeAtZeroWater = 0;
                    }
                    
                    // Happiness decay
                    if (!plant.isDead) {
                        const happinessDecay = Math.min(minutesAway * 1, 60);
                        plant.happiness = Math.max(0, plant.happiness - happinessDecay);
                        
                        // Extra happiness decrease if water is very low
                        if (plant.waterLevel < 20) {
                            plant.happiness = Math.max(0, plant.happiness - minutesAway * 0.5);
                        }
                    }
                }
                
                plant.lastUpdate = now;
            });
            
            if (maxMinutesAway > 1) {
                showWelcomeBackMessage(maxMinutesAway);
            }
            
            updateUI();
            saveGame();
        }

        function saveGame() {
            try {
                getCurrentPlant().lastUpdate = Date.now();
                localStorage.setItem('plantCareGame', JSON.stringify(gameState));
            } catch (error) {
                console.log('Could not save game data:', error);
            }
        }

        function showWelcomeBackMessage(minutesAway) {
            const hours = Math.floor(minutesAway / 60);
            const mins = Math.floor(minutesAway % 60);
            
            let timeString = '';
            if (hours > 0) {
                timeString = `You were away for ${hours} hour${hours > 1 ? 's' : ''} and ${mins} minute${mins > 1 ? 's' : ''}.`;
            } else {
                timeString = `You were away for ${mins} minute${mins > 1 ? 's' : ''}.`;
            }
            
            showNotification(8000, `ğŸ  Welcome back! ${timeString}`);
        }

        function updateUI() {
            const currentPlant = getCurrentPlant();
            
            document.getElementById('water-bar').style.width = currentPlant.waterLevel + '%';
            document.getElementById('happiness-bar').style.width = currentPlant.happiness + '%';
            document.getElementById('water-percent').textContent = Math.round(currentPlant.waterLevel) + '%';
            document.getElementById('happiness-percent').textContent = Math.round(currentPlant.happiness) + '%';
            document.getElementById('plant-type').textContent = gameState.currentPlant.charAt(0).toUpperCase() + gameState.currentPlant.slice(1);
            document.getElementById('plant').textContent = currentPlant.emoji;
            
            const pot = document.getElementById('pot');
            const plant = document.getElementById('plant');
            const waterBtn = document.getElementById('water-btn');
            const resetBtn = document.getElementById('reset-btn');
            const decorateBtn = document.getElementById('decorate-btn');
            const statusElement = document.getElementById('plant-status');
            
            colors.forEach(color => {
                if (color) pot.classList.remove(color);
            });
            const currentColor = colors[currentPlant.colorIndex];
            if (currentColor) {
                pot.classList.add(currentColor);
            }
            
            if (currentPlant.isDead) {
                plant.classList.add('dead');
                plant.classList.remove('happy', 'sad');
                statusElement.textContent = 'ğŸ’€ Dead';
                statusElement.style.color = '#ff6b6b';
                waterBtn.style.display = 'none';
                resetBtn.style.display = 'inline-block';
                decorateBtn.disabled = true;
                decorateBtn.style.background = 'grey'
                
                showNotification(6000, `ğŸ’€ Your ${gameState.currentPlant} is dead! Click Reset Plant to start over.`);
            } else {
                plant.classList.remove('dead');
                statusElement.textContent = 'ğŸ™‚ Alright';
                statusElement.style.color = '#00b894';
                waterBtn.style.display = 'inline-block';
                resetBtn.style.display = 'none';
                decorateBtn.disabled = false;
                
                if (currentPlant.happiness > 60) {
                    if (currentPlant.waterLevel > 75) {
                        statusElement.textContent = 'ğŸ˜ Amazing';
                    }
                    else if (currentPlant.waterLevel > 45){
                        statusElement.textContent = 'ğŸ˜ Happy';
                    }
                    plant.classList.add('happy');
                    plant.classList.remove('sad');
                } else if (currentPlant.happiness < 40) {
                    if ( 30 < currentPlant.waterLevel < 50) {
                        statusElement.textContent = 'ğŸ˜“ Unhappy';
                    }
                    else if (currentPlant.waterLevel < 30 ) {
                        statusElement.textContent = 'ğŸ˜° Terrible';
                    }
                    plant.classList.add('sad');
                    plant.classList.remove('happy');
                } else {
                    plant.classList.remove('happy', 'sad');
                }
            }
        }

        function waterPlant() {
            const currentPlant = getCurrentPlant();
            
            if (currentPlant.waterLevel < 100) {
                currentPlant.waterLevel = Math.min(100, currentPlant.waterLevel + 20);
                currentPlant.happiness = Math.min(100, currentPlant.happiness + 10);
                currentPlant.lastWatered = Date.now();
                currentPlant.timeAtZeroWater = 0; // Reset death timer
                
                showNotification(3000, 'ğŸ’§ Plant watered! Your plant is happy!');
                updateUI();
                saveGame();
            } else {
                showNotification(3000, 'ğŸŒŠ Plant is already well watered!');
            }
        }

        function decoratePot() {
            const currentPlant = getCurrentPlant();
            
            currentPlant.colorIndex = (currentPlant.colorIndex + 1) % colors.length;
            currentPlant.happiness = Math.min(100, currentPlant.happiness + 5);
            
            const currentColor = colors[currentPlant.colorIndex];
            const colorName = currentColor || 'default brown';
            
            showNotification(3000, `ğŸ¨ Pot is now ${colorName}!`);
            updateUI();
            saveGame();
        }

        function resetPlant() {
            const currentPlant = getCurrentPlant();
            currentPlant.isDead = false;
            currentPlant.waterLevel = 50;
            currentPlant.happiness = 40;
            currentPlant.timeAtZeroWater = 0;
            currentPlant.lastUpdate = Date.now();
            currentPlant.colorIndex = 0; // Reset pot color too
            const decorateBtn = document.getElementById('decorate-btn');
            
            decorateBtn.style.background = 'linear-gradient(45deg, #e91e63, #f06292)'
            
            showNotification(5000, `ğŸŒ± Your ${gameState.currentPlant} has been reset! Take better care this time!`);
            updateUI();
            saveGame();
        }

        function showPlantMenu() {
            document.getElementById('plant-menu').classList.add('active');
        }

        function closePlantMenu() {
            document.getElementById('plant-menu').classList.remove('active');
        }

        function selectPlant(type, emoji) {
            gameState.currentPlant = type;
            
            const newPlant = getCurrentPlant();
            if (!newPlant.isDead) {
                newPlant.happiness = Math.min(100, newPlant.happiness + 5);
                showNotification(3000, `ğŸŒ± Switched to your ${type}! ${emoji}`);
            }
            
            updateUI();
            saveGame();
            closePlantMenu();
        }

        function showNotification(time, message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, time);
        }

        // decrease water and happiness over time while playing
        function gameLoop() {
            const now = Date.now();
            
            Object.keys(gameState.plants).forEach(plantType => {
                const plant = gameState.plants[plantType];
                const config = plantConfigs[plantType];
                
                if (!plant.isDead) {
                    const timeSinceLastUpdate = now - plant.lastUpdate;
                    const minutesElapsed = timeSinceLastUpdate / (1000 * 60);
                    
                    const waterLoss = minutesElapsed * config.waterLossRate;
                    const oldWaterLevel = plant.waterLevel;
                    plant.waterLevel = Math.max(0, plant.waterLevel - waterLoss);
                    
                    if (plant.waterLevel === 0) {
                        if (oldWaterLevel > 0) {
                            plant.timeAtZeroWater = minutesElapsed - (oldWaterLevel / config.waterLossRate);
                        } else {
                            plant.timeAtZeroWater += minutesElapsed;
                        }
                        
                        if (plant.timeAtZeroWater >= config.deathTime) {
                            plant.isDead = true;
                            plant.happiness = 0;
                            if (plantType === gameState.currentPlant) {
                                showNotification(8000, `ğŸ’€ Your ${plantType} has died from lack of water!`);
                            }
                        }
                    } else {
                        plant.timeAtZeroWater = 0;
                    }
                    
                    if (!plant.isDead) {
                        plant.happiness = Math.max(0, plant.happiness - minutesElapsed * 1);
                        
                        if (plant.waterLevel < 20) {
                            plant.happiness = Math.max(0, plant.happiness - minutesElapsed * 2);
                        }
                    }
                }
                
                plant.lastUpdate = now;
            });
            
            const currentPlant = getCurrentPlant();
            
            if (!currentPlant.isDead) {
                if (currentPlant.waterLevel <= 10) {
                    showNotification(3000, 'ğŸš¨ Your plant is very thirsty!');
                } else if (currentPlant.waterLevel <= 30) {
                    showNotification(3000, 'ğŸ’§ Your plant needs water soon!');
                }
                
                if (currentPlant.happiness <= 10) {
                    showNotification(3000, 'ğŸ˜¢ Your plant is very sad!');
                } else if (currentPlant.happiness <= 30) {
                    showNotification(3000, 'ğŸ˜ Your plant needs attention!');
                }
                
                if (currentPlant.waterLevel === 0) {
                    const timeLeft = plantConfigs[gameState.currentPlant].deathTime - currentPlant.timeAtZeroWater;
                    if (timeLeft <= 2 && timeLeft > 0) {
                        showNotification(5000, `âš ï¸ Your plant will die in ${Math.round(timeLeft)} minutes without water!`);
                    }
                }
            }
            
            updateUI();
            saveGame();
        }

        // Save game state when page is about to unload
        window.addEventListener('beforeunload', function() {
            saveGame();
        });

        // Save periodically in case of unexpected closure
        setInterval(saveGame, 30000); // Save every 30 seconds

        // Initialize game
        loadGame();
        setInterval(gameLoop, 60000); // Run every 60 seconds (1 minute)
    </script>
</body>
</html>
